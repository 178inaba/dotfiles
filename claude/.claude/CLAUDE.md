## コーディング・対応方針

- **言語**: 日本語での質問・回答をお願いします
- **ファイル形式**: ファイルの最後に改行文字を必ず追加してください（POSIX標準準拠）
- **EditorConfig**: プロジェクトに.editorconfigファイルが存在する場合は、その設定に必ず従ってください（indent_style, indent_size, insert_final_newline, end_of_line等）
- **コメント**: 既存のコメント言語（英語/日本語）を踏襲し、コードベース全体で一貫性を保ってください
- **エラーハンドリング**: 言語別パターン
  - **Go言語**: 戻り値を使わない場合、条件文内でエラーハンドリングを行う慣用パターンを使用
    ```go
    // 推奨パターン（戻り値を使わない場合）
    if _, err := someFunction(); err != nil {
        return err
    }
    ```
  - **TypeScript/JavaScript**: エラーオブジェクトを使用しない場合はparameterless catch使用
    ```typescript
    // 推奨パターン（エラーオブジェクト不使用）
    try {
        riskyOperation()
    } catch {
        // エラー処理（オブジェクト不要）
    }

    // エラー詳細が必要な場合のみ
    try {
        riskyOperation()
    } catch (error) {
        console.error(error.message)
    }
    ```

## 差分レビュー方針

詳細: @~/.claude/context/workflows/code-review.md

## テスト開発原則

- **テスト失敗時の対応順序**:
  1. **実装コードの動作確認**: まずブラウザやCLI等で実際の動作を確認
  2. **根本原因の特定**: 実装の問題かテストの問題かを正確に判断
  3. **適切な修正**: 実装に問題があれば実装を修正、テストに問題があればテストを修正
  4. **不要コード削除**: 試行錯誤で追加した不要なモック・デバッグコードをクリーンアップ
- **禁止パターン**: テスト失敗→即座にモック設定変更（根本原因を見逃す）
- **最小限修正**: 必要最小限の変更のみを実施、過度なモック化は避ける

## Git操作規約

- **ブランチ切り替え**: `git switch`を使用（`git checkout`ではなく）
- **コミットメッセージ**: プロジェクト標準に従う

## 開発ワークフロー

- **Sub-Issues管理**: @~/.claude/context/tools/github-sub-issues.md
- **TypeScript/ESLint アップグレード**: @~/.claude/context/workflows/typescript-eslint-upgrade.md
- **大規模機能開発**: @~/.claude/context/workflows/feature-development.md

## 仕様遵守原則

**必須実施事項**: すべての実装作業で以下を厳格に実行すること

### 1. 仕様書の読み間違いを防ぐ方法

#### ✅ チェックリスト方式
実装前に必ず以下を確認：
- [ ] 仕様書の全セクションを読み返した
- [ ] 要件を箇条書きで列挙した
- [ ] 各要件に対応する実装方法を明記した
- [ ] 「〜と同等」「〜相当」などの参照要件を確認した

#### ✅ 要件の構造化
実装前に要件マトリックス表を作成：
```markdown
| 機能 | 要件1 | 要件2 | 要件3 | 実装状況 |
|------|-------|-------|-------|----------|
| 仕様 | XXX   | YYY   | ZZZ   | -        |
| 実装 | ☑️    | ❌    | ☑️    | 2/3完了  |
```

### 2. 実装の簡略化を防ぐ方法

#### ✅ 「なぜ」を必ず記録
すべての実装判断にコメントで理由を明記：
```typescript
// 仕様書 Chapter X.Y により機能Aは全項目対応が必須
// 既存システムと同等の機能を提供する必要がある
```

#### ✅ 勝手な判断の禁止ルール
- 仕様書に明記された要件は**絶対に削除・変更しない**
- 「シンプルにする」「使いやすくする」等の理由で勝手に仕様変更しない
- 仕様変更が必要な場合は必ずユーザーに確認・承認を得る

### 3. 確認不足を防ぐ方法

#### ✅ 段階的確認
各段階で仕様書との照合を実施：
1. **設計時**: 仕様書と設計の対応表作成
2. **実装時**: 各コンポーネント完成後に仕様書と照合
3. **統合時**: システム全体で要件を満たしているか確認

#### ✅ TodoWrite更新時の仕様チェック
Todo更新時に仕様適合状況を併記：
```markdown
- [x] 機能A実装 ← 仕様書 Chapter X.Y ✅対応
- [❌] 機能B実装 ← 仕様書 Chapter X.Z ❌未対応
```

### 実施タイミング

- **実装開始前**: チェックリスト方式 + 要件構造化
- **実装中**: 各ファイル作成後の仕様照合 + 理由記録
- **完了時**: 段階的確認 + TodoWrite仕様チェック
- **報告前**: 全要件に対する実装状況の最終確認

## SPA画面遷移での状態保持設計

一覧画面から詳細画面への遷移時に、ユーザーの操作状態（ページ番号・検索条件・ソート順等）を保持する設計パターン。

### 基本概念
- **課題**: 詳細画面からブラウザの戻るボタンで戻ると、一覧画面が初期状態にリセットされる
- **解決策**: 遷移前の状態を一時保存し、戻り時に復元する

### 実装アプローチ
1. **SessionStorage パターン（推奨）**
   - 画面遷移前にSessionStorageに状態を保存
   - 戻り時にSessionStorageから状態を復元
   - ブラウザセッション終了時に自動クリア

2. **URL クエリパラメータ パターン**
   - 状態をURLに埋め込んで保持
   - ブックマーク・共有可能
   - URLが長くなりがち

3. **状態管理ライブラリ パターン**
   - Vuex、Redux等で状態を一元管理
   - アプリケーション全体での状態共有
   - リロード時に状態が失われる

### 設計上の重要ポイント
1. **一意性の確保**: 同じエンティティへの戻りかを必ずチェック
2. **メモリリーク防止**: 使用後は必ず状態をクリア
3. **エラー耐性**: データ破損時は通常フローにフォールバック
4. **条件付き復元**: 状態が設定されている場合のみデータ再取得

## 大規模データテーブルでのソート最適化

数千〜数万件のデータを扱うテーブルでのソート機能において、UX・パフォーマンス両面を考慮した設計パターン。

### 基本概念
- **クライアントサイドソート**: 全データをブラウザに読み込んでJavaScriptでソート
- **サーバーサイドソート**: データベースレベルでソートしてページング結果を取得

### サーバーサイドソートが必要な理由
1. **メモリ使用量**: 大量データの全件取得を避ける
2. **初期表示速度**: 必要最小限のデータのみ取得
3. **ネットワーク負荷**: データ転送量の削減
4. **レスポンシブ性**: UIがブロックされない

### 実装パターン
1. **数値マッピング方式**
   - フロントエンド: ソート状態を数値で管理（1=昇順、2=降順）
   - バックエンド: 数値からSQL ORDER BY句を生成

2. **3状態ソート**
   - 昇順 → 降順 → デフォルト（無ソート）の順で切り替え
   - ユーザーがソートを解除可能

3. **セカンダリーソート**
   - 主ソートキーが同値の場合の並び順を一意に決定
   - 通常はIDをセカンダリーキーとして使用

### パフォーマンス最適化技法
1. **NULL値の適切な扱い**: `COALESCE`でNULL値を明示的に処理
2. **インデックス活用**: ソート対象カラムにインデックスを設定
3. **JOINの最適化**: 必要最小限のテーブル結合
4. **ページング連携**: LIMIT/OFFSETと組み合わせて使用

## スラッシュコマンド作成パターン

`~/.claude/commands/` 配下のスラッシュコマンドを作成する際の標準構成：

### 基本構成
```markdown
# /command-name
概要（1行）

## 使用方法
```
/command-name
```

## 実行内容
1. 手順1
2. 手順2
...

## 前提条件（該当する場合のみ）
- 条件1
- 条件2

## 判断基準（複雑な判断が必要な場合のみ）
### パターンA
- [ ] 条件1
- [ ] 条件2

### パターンB
- [ ] 条件3
- [ ] 条件4

## 注意事項（必要に応じて）
1. 注意点1
2. 注意点2
```

### 設計原則
1. **シンプル性**: 既存コマンド（git-commit.md等）と一貫した構成
2. **必要最小限**: 関連コマンド・更新履歴等の冗長なセクションは避ける
3. **実用性**: 実際の使用時に必要な情報のみを含める
4. **一貫性**: 全コマンド間でフォーマットを統一

## Gitサブモジュール操作での注意点

### ディレクトリ移動ミス防止パターン
サブモジュール構成（例: backend/, frontend/が独立したGitリポジトリ）での作業時の確実な移動方法。

#### 必須手順
1. **現在地確認**: 移動前に必ず`pwd`でディレクトリを確認
2. **絶対パス使用**: 相対パスではなく絶対パスで移動
3. **移動後確認**: 移動後に再度`pwd`で確認

#### 標準パターン
```bash
# 悪い例（相対パス・現在地未確認）
cd ../backend
cd frontend

# 良い例（絶対パス・現在地確認）
pwd  # 現在地確認
cd /path/to/project/backend
pwd  # 移動後確認
```

#### よくある失敗パターンと対策
- **`cd ..`の重複実行**: 意図しない親ディレクトリへの移動
  - 対策: 絶対パスでの移動を徹底
- **サブモジュール間の移動ミス**: `cd ../frontend`と`cd frontend`の混同
  - 対策: 常に現在地確認後に絶対パス移動
- **異なるGitリポジトリの混同**: サブモジュールとルートリポジトリの操作ミス
  - 対策: `git status`でリポジトリ状況を確認してから作業

## コンテキスト管理

- **自動更新**: 重要な汎用的コンテキスト（開発ワークフロー、よく使うツール・コマンド、環境設定等）を発見した場合、このCLAUDE.mdまたは適切な context/ ファイルに自動で追記してください
- **分離基準**:
  - CLAUDE.md直接: 基本方針・原則、必須コンテキスト、短くて変更頻度が低いもの
  - context/別ファイル: 詳細ドキュメント、変更頻度が高いもの、特定用途専用のもの
- **リンク形式**: 別ファイル参照時は `@~/.claude/context/カテゴリ/ファイル名.md` 形式を使用
