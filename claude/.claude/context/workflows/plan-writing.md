# 計画作成ガイドライン

## 前提

ユーザーは計画承認時に「Clear context and auto-accept edits」を選択する。
コンテキストクリア後、Claudeが持つ情報は以下のみ：
- CLAUDE.md + contextファイル群（常に読み込まれる）
- 計画ファイル（Plan fileの内容）

**計画ファイルは、会話コンテキストなしで実装可能な自己完結的ドキュメントでなければならない。**

## 計画に必ず含める情報

### 1. 背景・目的
- なぜこの変更が必要か（ユーザーの要求を正確に記載）
- 期待される最終状態

### 2. 対象ファイル一覧（絶対パス）
変更・作成・削除するすべてのファイルを列挙：
```
- 変更: /path/to/existing/file.ts（関数Xを修正）
- 作成: /path/to/new/file.ts（新規コンポーネント）
- 削除: /path/to/obsolete/file.ts
```

### 3. 既存コードの関連箇所
変更対象の**現在のコード**を引用（行番号付き）。コンテキストクリア後はファイルを読み直すが、何を探すべきかの指針として必須：
```
// /path/to/file.ts:42-55 の現在の実装
function existingFunction() {
  // ...現在のコード...
}
```

### 4. 具体的な変更内容
各ファイルに対して、**何を・どう変更するか**を明確に記述：
- Before/After形式、または差分の詳細説明
- 新規ファイルは構造・主要なコード・エクスポートを記載
- 「会話で確認した通り」等の後方参照は**絶対に使わない**

### 5. 実装順序
ファイル間の依存関係を考慮した実装順：
```
Step 1: entity/errors.go にエラー定義を追加
Step 2: repository/user.go を修正（Step 1のエラーを使用）
Step 3: handler/user.go を修正（Step 2の変更に対応）
Step 4: テスト追加
```

### 6. ビルド・テスト・検証コマンド
```bash
# ビルド確認
go build ./...

# テスト実行
go test ./path/to/package/...

# Lint
npm run lint
```

### 7. 受け入れ基準
実装完了の判定条件を明確に：
- [ ] 全テストが通る
- [ ] 特定の機能が動作する
- [ ] エラーケースが適切に処理される

## 禁止事項

- **後方参照の禁止**: 「上記で議論した」「先ほど確認した」「現在の実装を参照」等は使わない
- **曖昧な指示の禁止**: 「適切に修正する」「必要に応じて変更」は具体的に書き直す
- **暗黙の前提の禁止**: ユーザーとの会話で共有された暗黙知は計画に明文化する

## 計画の粒度

### 小規模変更（1-3ファイル）
- 変更内容をコード差分レベルで記載
- Before/After形式が最適

### 中規模変更（4-10ファイル）
- ファイルごとの変更概要 + 重要部分のコード
- 実装順序を明記

### 大規模変更（10ファイル超）
- Phase分割して各Phaseを独立した実装単位に
- Phase間の依存関係を明記
- 各Phaseの検証ポイントを設定
